<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Fustor Benchmark Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 40px; background: #f4f7f6; color: #333; }
        .container { max-width: 1300px; margin: auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-top: 0; }
        .summary { display: flex; justify-content: space-between; margin: 30px -10px; }
        .stat-card { background: #fff; padding: 20px; border-radius: 10px; flex: 1; margin: 0 10px; text-align: center; border: 1px solid #eee; border-top: 5px solid #3498db; transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card.fusion { border-top-color: #2ecc71; }
        .stat-card.integrity { border-top-color: #e74c3c; }
        .stat-card.gain { border-top-color: #f1c40f; }
        .stat-value { font-size: 28px; font-weight: bold; margin: 10px 0; color: #2c3e50; }
        .stat-label { font-size: 14px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; }
        .chart-row { display: flex; gap: 20px; margin-bottom: 40px; }
        .chart-box { flex: 1; background: #fff; padding: 20px; border-radius: 10px; border: 1px solid #eee; min-width: 0; }
        .chart-container { position: relative; height: 350px; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; table-layout: fixed; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        th { background: #f8f9fa; color: #2c3e50; font-weight: 600; }
        .info-bar { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 30px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 13px; }
        .info-item { display: flex; gap: 10px; }
        .info-label { color: #5a6c7a; font-weight: 600; min-width: 100px; }
        .note-box { background: #fff9db; padding: 15px; border-left: 5px solid #fcc419; margin: 20px 0; font-size: 14px; line-height: 1.6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fustor Performance Benchmark</h1>
        <div class="info-bar">
            <div class="info-item"><span class="info-label">ğŸ“… Timestamp:</span> <strong>{{timestamp}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ“‚ Data Scale:</span> <strong>{{total_files}} files ({{total_dirs}} dirs)</strong></div>
            <div class="info-item"><span class="info-label">ğŸš€ Requests:</span> <strong>{{reqs}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ“‚ Target Depth:</span> <strong>{{depth}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ‘¥ Concurrency:</span> <strong>{{concurrency}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ·ï¸ Target Folders:</span> <strong>{{target_count}}</strong></div>
        </div>

        <div class="summary">
            <div class="stat-card">
                <div class="stat-label">OS Baseline (Pure Scan)</div>
                <div class="stat-value">{{os_avg}} ms</div>
            </div>
            <div class="stat-card integrity">
                <div class="stat-label">OS Integrity (Optimistic)</div>
                <div class="stat-value">{{os_integrity_avg}} ms</div>
            </div>
            <div class="stat-card fusion">
                <div class="stat-label">Fusion API (Perception)</div>
                <div class="stat-value">{{fusion_avg}} ms</div>
            </div>
            <div class="stat-card gain">
                <div class="stat-label">Speedup (vs Integrity)</div>
                <div class="stat-value" style="color: #2ecc71">{{gain}}</div>
            </div>
        </div>

        <div class="note-box">
            <strong>ğŸ“¢ é‡è¦è¯´æ˜ (Benchmarking Note):</strong><br>
            æœ¬æ¬¡æµ‹è¯•ä¸­çš„ <strong>OS Integrity</strong> è¡¨ç°ä¸ºè¯¥æ–¹æ¡ˆçš„ <strong>ç†è®ºæœ€ä¼˜æƒ…å½¢ (Best-case Scenario)</strong>ã€‚
            ç”±äºæµ‹è¯•ç›®æ ‡è·¯å¾„æ˜¯é€šè¿‡ Fusion API é¢„å…ˆå‘ç°çš„ï¼Œè¿™æ„å‘³ç€è¿™äº›æ–‡ä»¶å¤¹åœ¨é‡‡æ ·å¼€å§‹å‰å°±å·²ç»å¤„äºâ€œå®Œæ•´ä¸”ç¨³å®šâ€çš„çŠ¶æ€ã€‚åœ¨çœŸå®ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœå­˜åœ¨å¤§é‡æ­£åœ¨å†™å…¥çš„æ–‡ä»¶ï¼ŒOS Integrity æ–¹æ¡ˆé€šå¸¸éœ€è¦å¤šæ¬¡å¾ªç¯é‡‡æ ·æˆ–æ›´é•¿çš„é™é»˜æœŸï¼Œå…¶å®é™…å»¶è¿Ÿå°†è¿œé«˜äºæœ¬æ¬¡æµ‹é‡å€¼ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒFusion API é€šè¿‡äº‹ä»¶æ„ŸçŸ¥æœºåˆ¶ï¼Œæ— è®ºç¯å¢ƒå¤æ‚åº¦å¦‚ä½•ï¼Œå‡èƒ½ä¿æŒæ’å®šçš„æé€Ÿå“åº”ã€‚
        </div>

        <div class="chart-row">
            <div class="chart-box">
                <h3>Core Performance Comparison (Latency)</h3>
                <div class="chart-container"><canvas id="barChart"></canvas></div>
            </div>
            <div class="chart-box">
                <h3>Latency Percentiles (Distribution)</h3>
                <div class="chart-container"><canvas id="lineChart"></canvas></div>
            </div>
        </div>

        <h2>Detailed Metrics Comparison (ms)</h2>
        <table id="metrics-table">
            <thead>
                <tr>
                    <th style="width: 20%">Metric</th>
                    <th>OS Baseline</th>
                    <th>OS Integrity</th>
                    <th>Fusion Dry-Net</th>
                    <th>Fusion Dry-Run</th>
                    <th>Fusion API</th>
                </tr>
            </thead>
            <tbody>
                <!-- Populated by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        // The data is injected here by reporter.py
        const rawData = /* RESULTS_JSON_DATA */;
        
        function format(num, decimals = 2) {
            return num ? num.toFixed(decimals) : '0.00';
        }

        // 1. Populate Table
        const tableBody = document.querySelector('#metrics-table tbody');
        const metrics = [
            { label: 'Avg Latency', key: 'avg' },
            { label: 'P50 (Median)', key: 'p50' },
            { label: 'P95 Latency', key: 'p95' },
            { label: 'P99 Latency', key: 'p99' },
            { label: 'QPS', key: 'qps', dec: 1 },
            { label: 'Min', key: 'min' },
            { label: 'Max', key: 'max' }
        ];
        
        const groups = ['os', 'os_integrity', 'fusion_dry_net', 'fusion_dry', 'fusion'];
        
        metrics.forEach(m => {
            const row = document.createElement('tr');
            row.innerHTML = `<td><strong>${m.label}</strong></td>` + 
                groups.map(g => `<td>${format(rawData[g][m.key], m.dec)}</td>`).join('');
            tableBody.appendChild(row);
        });

        // 2. Bar Chart
        new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
                labels: ['Avg Latency', 'Median (P50)', 'P95 Latency'],
                datasets: [
                    { label: 'OS Baseline', data: [rawData.os.avg, rawData.os.p50, rawData.os.p95], backgroundColor: '#3498db' },
                    { label: 'OS Integrity', data: [rawData.os_integrity.avg, rawData.os_integrity.p50, rawData.os_integrity.p95], backgroundColor: '#e74c3c' },
                    { label: 'Fusion API', data: [rawData.fusion.avg, rawData.fusion.p50, rawData.fusion.p95], backgroundColor: '#2ecc71' }
                ]
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } }
            }
        });

        // 3. Line Chart
        const percentileLabels = ['Min', 'P50', 'P75', 'P90', 'P95', 'P99', 'Max'];
        const getSeries = (g) => [rawData[g].min, rawData[g].p50, rawData[g].p75, rawData[g].p90, rawData[g].p95, rawData[g].p99, rawData[g].max];

        new Chart(document.getElementById('lineChart'), {
            type: 'line',
            data: {
                labels: percentileLabels,
                datasets: [
                    { label: 'OS Baseline', data: getSeries('os'), borderColor: '#3498db', fill: false, tension: 0.1 },
                    { label: 'OS Integrity', data: getSeries('os_integrity'), borderColor: '#e74c3c', fill: false, tension: 0.1 },
                    { label: 'Fusion API', data: getSeries('fusion'), borderColor: '#2ecc71', fill: false, tension: 0.1 }
                ]
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                scales: { y: { type: 'logarithmic', title: { display: true, text: 'ms (Log Scale)' } } }
            }
        });
    </script>
</body>
</html>