<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Fustor Benchmark Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 40px; background: #f4f7f6; color: #333; }
        .container { max-width: 1300px; margin: auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-top: 0; }
        .summary { display: flex; justify-content: space-between; margin: 30px -10px; }
        .stat-card { background: #fff; padding: 20px; border-radius: 10px; flex: 1; margin: 0 10px; text-align: center; border: 1px solid #eee; border-top: 5px solid #3498db; transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card.fusion { border-top-color: #2ecc71; }
        .stat-card.integrity { border-top-color: #e74c3c; }
        .stat-card.gain { border-top-color: #f1c40f; }
        .stat-value { font-size: 28px; font-weight: bold; margin: 10px 0; color: #2c3e50; }
        .stat-label { font-size: 14px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; }
        .chart-row { display: flex; gap: 20px; margin-bottom: 40px; }
        .chart-box { flex: 1; background: #fff; padding: 20px; border-radius: 10px; border: 1px solid #eee; min-width: 0; }
        .chart-container { position: relative; height: 350px; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; table-layout: fixed; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        th { background: #f8f9fa; color: #2c3e50; font-weight: 600; }
        .info-bar { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 30px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 13px; }
        .info-item { display: flex; gap: 10px; }
        .info-label { color: #5a6c7a; font-weight: 600; min-width: 100px; }
        .note-box { background: #fff9db; padding: 15px; border-left: 5px solid #fcc419; margin: 20px 0; font-size: 14px; line-height: 1.6; }
        .methodology h3 { color: #2c3e50; margin-top: 25px; border-left: 4px solid #3498db; padding-left: 10px; }
        .methodology ul { padding-left: 20px; }
        .methodology li { margin-bottom: 10px; }
        .task-name { font-weight: bold; color: #2980b9; }
        .param-value { color: #e67e22; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fustor Performance Benchmark</h1>
        <div class="info-bar">
            <div class="info-item"><span class="info-label">ğŸ“… Timestamp:</span> <strong>{{timestamp}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ“‚ Data Scale:</span> <strong>{{total_files}} files ({{total_dirs}} dirs)</strong></div>
            <div class="info-item"><span class="info-label">ğŸš€ Requests:</span> <strong>{{reqs}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ“‚ Target Depth:</span> <strong>{{depth}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ‘¥ Concurrency:</span> <strong>{{concurrency}}</strong></div>
            <div class="info-item"><span class="info-label">â±ï¸ Integrity Intv:</span> <strong class="param-value">{{integrity_interval}}s</strong></div>
        </div>

        <div class="summary">
            <div class="stat-card">
                <div class="stat-label">OS Baseline (Pure Scan)</div>
                <div class="stat-value">{{os_avg}} ms</div>
            </div>
            <div class="stat-card integrity">
                <div class="stat-label">OS Integrity (Standard Safe)</div>
                <div class="stat-value">{{os_integrity_avg}} ms</div>
            </div>
            <div class="stat-card fusion">
                <div class="stat-label">Fusion API (Perception)</div>
                <div class="stat-value">{{fusion_avg}} ms</div>
            </div>
            <div class="stat-card gain">
                <div class="stat-label">Speedup (vs Integrity)</div>
                <div class="stat-value" style="color: #2ecc71">{{gain}}</div>
            </div>
        </div>

        <div class="note-box">
            <strong>ğŸ“¢ æ–¹æ¡ˆåˆç†æ€§è¯´æ˜ (Scientific Justification):</strong><br>
            æœ¬æ¬¡æµ‹è¯•ä¸­çš„ <strong>OS Integrity</strong> é™é»˜æœŸè®¾ä¸º <span class="param-value">{{integrity_interval}}s</span>ã€‚è¿™å¹¶ééšæ„è®¾å®šï¼Œè€Œæ˜¯ä¸¥æ ¼éµå¾ªäº† <strong>Linux NFS åè®®çš„é»˜è®¤æ ‡å‡†</strong>ã€‚åœ¨ NFS æŒ‚è½½å‚æ•°ä¸­ï¼Œ<code>acregmax</code> å’Œ <code>acdirmax</code>ï¼ˆå…ƒæ•°æ®æœ€å¤§ç¼“å­˜æ—¶é—´ï¼‰çš„é»˜è®¤å€¼é€šå¸¸ä¸º <strong>60 ç§’</strong>ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåªæœ‰ç­‰å¾…è¶…è¿‡è¯¥æ—¶é—´ï¼Œæ‰èƒ½ç¡®ä¿ä¸åŒå®¢æˆ·ç«¯çœ‹åˆ°çš„ ctime å’Œæ–‡ä»¶å¤§å°æ˜¯ä¸€è‡´ä¸”æœ€ç»ˆæ­£ç¡®çš„ã€‚Fusion API æˆåŠŸçš„å…³é”®åœ¨äºå…¶ <strong>Perception (æ„ŸçŸ¥)</strong> æ¶æ„ï¼Œé€šè¿‡åœ¨å†™å…¥ç«¯å®æ—¶æ‹¦æˆªç³»ç»Ÿäº‹ä»¶ï¼Œå½»åº•æ¶ˆé™¤äº†è¿™ 60 ç§’çš„ç‰©ç†åŒæ­¥å£å’ã€‚
        </div>

        <div class="chart-row">
            <div class="chart-box">
                <h3>Core Performance Comparison (Latency)</h3>
                <div class="chart-container"><canvas id="barChart"></canvas></div>
            </div>
            <div class="chart-box">
                <h3>Latency Percentiles (Distribution)</h3>
                <div class="chart-container"><canvas id="lineChart"></canvas></div>
            </div>
        </div>

        <h2>Detailed Metrics Comparison (ms)</h2>
        <table id="metrics-table">
            <thead>
                <tr>
                    <th style="width: 20%">Metric</th>
                    <th>OS Baseline</th>
                    <th>OS Integrity</th>
                    <th>Fusion Dry-Net</th>
                    <th>Fusion Dry-Run</th>
                    <th>Fusion API</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="methodology">
            <h2>Test Methodology & Documentation (æµ‹è¯•ä»»åŠ¡è¯¦è§£)</h2>
            
            <section>
                <h3>1. ä»»åŠ¡å®šä¹‰ (Task Definitions)</h3>
                <ul>
                    <li><span class="task-name">OS Baseline (Pure find Scan)</span>: æœ€åŸå§‹çš„æ–‡ä»¶æ‰«ææ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆæ— æ³•è¯†åˆ«æ­£åœ¨å†™å…¥çš„æ–‡ä»¶ï¼Œåœ¨ NFS ç¯å¢ƒä¸‹ææ˜“äº§ç”Ÿâ€œè„è¯»â€ï¼Œæ•°æ®ä¸€è‡´æ€§ç­‰çº§ä¸ºâ€œä½â€ã€‚</li>
                    
                    <li><span class="task-name">OS Integrity (Double Sampling)</span>: æ¨¡æ‹Ÿ NFS ç¯å¢ƒä¸‹ç¡®ä¿æ–‡ä»¶å®Œæ•´çš„çœŸå®æ–¹æ¡ˆã€‚
                        <ol>
                            <li>æ‰§è¡Œé‡‡æ ·ï¼š<code>find ... -printf "%p\t%C@\t%s\n"</code>ã€‚</li>
                            <li><strong>æ‰§è¡Œ NFS å®‰å…¨é™é»˜æœŸç­‰å¾…ï¼š<span class="param-value">{{integrity_interval}}s</span>ã€‚</strong>ï¼ˆæ³¨ï¼šå¯¹åº”æ ‡å‡† NFS æŒ‚è½½å‚æ•° <code>acregmax=60</code>ï¼‰ã€‚</li>
                            <li>äºŒæ¬¡æ ¡éªŒï¼šå¯¹æ¯” ctime å’Œæ–‡ä»¶å¤§å°ï¼Œç¡®è®¤æ–‡ä»¶å·²å®Œå…¨åŒæ­¥å¹¶åœæ­¢å†™å…¥ã€‚</li>
                        </ol>
                    </li>

                    <li><span class="task-name">Fusion API (Perception Mode)</span>: åŸºäºå®æ—¶æ„ŸçŸ¥çš„å…ƒæ•°æ®æ£€ç´¢ã€‚<strong>Agent é€šè¿‡ Close-on-Write äº‹ä»¶ç›´æ¥è·å–â€œå®Œæ•´æ€§â€ä¿¡å·</strong>ï¼Œä½¿ Fusion æ— éœ€ä»»ä½•ç‰©ç†é™é»˜ç­‰å¾…å³å¯è¿”å›å¯é æ•°æ®ã€‚</li>
                </ul>
            </section>
        </div>
    </div>

    <script>
        const rawData = /* RESULTS_JSON_DATA */;
        function format(num, decimals = 2) { return num ? num.toFixed(decimals) : '0.00'; }
        const tableBody = document.querySelector('#metrics-table tbody');
        const metrics = [
            { label: 'Avg Latency', key: 'avg' },
            { label: 'P50 (Median)', key: 'p50' },
            { label: 'P95 Latency', key: 'p95' },
            { label: 'P99 Latency', key: 'p99' },
            { label: 'QPS', key: 'qps', dec: 1 },
            { label: 'Min', key: 'min' },
            { label: 'Max', key: 'max' }
        ];
        const groups = ['os', 'os_integrity', 'fusion_dry_net', 'fusion_dry', 'fusion'];
        metrics.forEach(m => {
            const row = document.createElement('tr');
            row.innerHTML = `<td><strong>${m.label}</strong></td>` + 
                groups.map(g => `<td>${format(rawData[g][m.key], m.dec)}</td>`).join('');
            tableBody.appendChild(row);
        });

        new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
                labels: ['Avg Latency', 'Median (P50)', 'P95 Latency'],
                datasets: [
                    { label: 'OS Baseline', data: [rawData.os.avg, rawData.os.p50, rawData.os.p95], backgroundColor: '#3498db' },
                    { label: 'OS Integrity', data: [rawData.os_integrity.avg, rawData.os_integrity.p50, rawData.os_integrity.p95], backgroundColor: '#e74c3c' },
                    { label: 'Fusion API', data: [rawData.fusion.avg, rawData.fusion.p50, rawData.fusion.p95], backgroundColor: '#2ecc71' }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });

        const pLabels = ['Min', 'P50', 'P75', 'P90', 'P95', 'P99', 'Max'];
        const getS = (g) => [rawData[g].min, rawData[g].p50, rawData[g].p75, rawData[g].p90, rawData[g].p95, rawData[g].p99, rawData[g].max];
        new Chart(document.getElementById('lineChart'), {
            type: 'line',
            data: {
                labels: pLabels,
                datasets: [
                    { label: 'OS Baseline', data: getS('os'), borderColor: '#3498db', fill: false, tension: 0.1 },
                    { label: 'OS Integrity', data: getS('os_integrity'), borderColor: '#e74c3c', fill: false, tension: 0.1 },
                    { label: 'Fusion API', data: getS('fusion'), borderColor: '#2ecc71', fill: false, tension: 0.1 }
                ]
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                scales: { y: { type: 'logarithmic', title: { display: true, text: 'ms (Log Scale)' } } }
            }
        });
    </script>
</body>
</html>