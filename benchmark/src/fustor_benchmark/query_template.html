<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Fustor Benchmark Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 40px; background: #f4f7f6; color: #333; }
        .container { max-width: 1400px; margin: auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-top: 0; }
        h2 { color: #34495e; margin-top: 40px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .summary-group { margin-bottom: 30px; }
        .summary-title { font-size: 18px; font-weight: bold; color: #7f8c8d; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .summary { display: flex; justify-content: space-between; margin: 0 -10px 20px -10px; }
        .stat-card { background: #fff; padding: 20px; border-radius: 10px; flex: 1; margin: 0 10px; text-align: center; border: 1px solid #eee; border-top: 5px solid #3498db; transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card.fusion { border-top-color: #2ecc71; }
        .stat-card.integrity { border-top-color: #e74c3c; }
        .stat-card.gain { border-top-color: #f1c40f; }
        .stat-value { font-size: 28px; font-weight: bold; margin: 10px 0; color: #2c3e50; }
        .stat-label { font-size: 14px; color: #7f8c8d; text-transform: uppercase; }
        .chart-row { display: flex; gap: 15px; margin-bottom: 40px; align-items: flex-start; }
        .chart-box { flex: 1; background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #eee; min-width: 0; }
        .chart-container { position: relative; height: 320px; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; table-layout: fixed; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        th { background: #f8f9fa; color: #2c3e50; font-weight: 600; }
        .info-bar { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 30px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 13px; }
        .info-item { display: flex; gap: 10px; }
        .info-label { color: #5a6c7a; font-weight: 600; min-width: 100px; }
        .note-box { background: #fff9db; padding: 15px; border-left: 5px solid #fcc419; margin: 20px 0; font-size: 14px; line-height: 1.6; }
        .task-name { font-weight: bold; color: #2980b9; }
        .param-value { color: #e67e22; font-weight: bold; }
        .optimistic-flag { color: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fustor Performance Benchmark</h1>
        <div class="info-bar">
            <div class="info-item"><span class="info-label">ğŸ“… Timestamp:</span> <strong>{{timestamp}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ“‚ Data Scale:</span> <strong>{{total_files}} files ({{total_dirs}} dirs)</strong></div>
            <div class="info-item"><span class="info-label">ğŸš€ Requests:</span> <strong>{{reqs}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ“‚ Target Depth:</span> <strong>{{depth}}</strong></div>
            <div class="info-item"><span class="info-label">ğŸ‘¥ Concurrency:</span> <strong>{{concurrency}}</strong></div>
            <div class="info-item"><span class="info-label">â±ï¸ Integrity Intv:</span> <strong class="param-value">{{integrity_interval}}s</strong></div>
        </div>

        <div class="summary-group">
            <div class="summary-title">Latency Summary (å“åº”å»¶è¿Ÿ)</div>
            <div class="summary">
                <div class="stat-card"><div class="stat-label">OS Baseline</div><div class="stat-value">{{os_avg}} ms</div></div>
                <div class="stat-card integrity"><div class="stat-label">OS Integrity <span class="optimistic-flag">(Best Case)</span></div><div class="stat-value">{{os_integrity_avg}} ms</div></div>
                <div class="stat-card fusion"><div class="stat-label">Fusion API</div><div class="stat-value">{{fusion_avg}} ms</div></div>
                <div class="stat-card gain"><div class="stat-label">Latency Speedup</div><div class="stat-value" style="color: #2ecc71">{{gain_latency}}</div></div>
            </div>
        </div>

        <div class="summary-group">
            <div class="summary-title">Throughput Summary (ç³»ç»Ÿååç‡)</div>
            <div class="summary">
                <div class="stat-card"><div class="stat-label">OS Baseline</div><div class="stat-value">{{os_qps}}</div></div>
                <div class="stat-card integrity"><div class="stat-label">OS Integrity <span class="optimistic-flag">(Best Case)</span></div><div class="stat-value">{{os_integrity_qps}}</div></div>
                <div class="stat-card fusion"><div class="stat-label">Fusion API</div><div class="stat-value">{{fusion_qps}}</div></div>
                <div class="stat-card gain"><div class="stat-label">QPS Gain</div><div class="stat-value" style="color: #2ecc71">{{gain_qps}}</div></div>
            </div>
        </div>

        <div class="chart-row">
            <div class="chart-box">
                <h3>Throughput (QPS) â†‘</h3>
                <div class="chart-container"><canvas id="qpsChart"></canvas></div>
            </div>
            <div class="chart-box">
                <h3>Avg Latency (ms) â†“</h3>
                <div class="chart-container"><canvas id="latencyChart"></canvas></div>
            </div>
            <div class="chart-box">
                <h3>Latency Percentiles â†“</h3>
                <div class="chart-container"><canvas id="lineChart"></canvas></div>
            </div>
        </div>

        <div class="note-box">
            <strong>âš ï¸ å®éªŒä¸¥è°¨æ€§è¯´æ˜ (Scientific Scrutiny):</strong><br>
            æœ¬æ¬¡æµ‹è¯•æµ‹å¾—çš„ <strong>OS Integrity (Double Sampling)</strong> å»¶è¿Ÿä¸ååç‡å‡ä¸ºè¯¥æ–¹æ¡ˆçš„ <strong><span class="optimistic-flag">ç†è®ºæœ€ä¼˜/æœ€ä¹è§‚æƒ…å†µ (Best-case Scenario)</span></strong>ï¼š
            <ul>
                <li>ç”±äºåŸºå‡†æµ‹è¯•çš„ç›®æ ‡æ–‡ä»¶å¤¹æ˜¯ç”± Fusion API é¢„å…ˆå‘ç°çš„ï¼Œè¿™æ„å‘³ç€è¿™äº›ç›®æ ‡åœ¨æµ‹è¯•å¼€å§‹å‰å°±å·²ç»æ˜¯ç¨³å®šã€å®Œæ•´çš„ã€‚</li>
                <li>åœ¨çœŸå®ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœæ–‡ä»¶æ­£å¤„äºæ´»è·ƒå†™å…¥çŠ¶æ€ï¼ŒOS Integrity æ–¹æ¡ˆåœ¨ç»å† 60s ç­‰å¾…åï¼Œé€šå¸¸ä¼šå› æ£€æµ‹åˆ°å…ƒæ•°æ®å˜åŒ–è€Œè¢«è¿«è¿›å…¥ <strong>â€œé‡è¯•å¾ªç¯â€</strong>ã€‚</li>
                <li><strong>ç»“è®º</strong>ï¼šçœŸå®ç¯å¢ƒä¸‹çš„ OS Integrity å»¶è¿Ÿå°†å‘ˆ 60s çš„å€æ•°çº§å¢é•¿ï¼Œååç‡å°†è¿›ä¸€æ­¥æŠ˜åŠã€‚è€Œ Fusion API æ— è®ºæ–‡ä»¶æ˜¯å¦æ­£åœ¨å†™å…¥ï¼Œå…¶æ€§èƒ½è¡¨ç°å§‹ç»ˆä¿æŒæ’å®šã€‚</li>
            </ul>
        </div>

        <h2>Detailed Metrics Comparison (ms)</h2>
        <table id="metrics-table">
            <thead>
                <tr>
                    <th style="width: 20%">Metric</th>
                    <th>OS Baseline</th>
                    <th>OS Integrity <span class="optimistic-flag">*</span></th>
                    <th>Fusion Dry-Net</th>
                    <th>Fusion Dry-Run</th>
                    <th>Fusion API</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="methodology">
            <h2>Test Methodology & Documentation (æµ‹è¯•ä»»åŠ¡è¯¦è§£)</h2>
            <section>
                <h3>1. ä»»åŠ¡å®šä¹‰ (Task Definitions)</h3>
                <ul>
                    <li><span class="task-name">OS Baseline (Pure find Scan)</span>: æ‰§è¡ŒåŸç”Ÿ <code>find</code> æ‰«æã€‚è¯¥æ–¹æ¡ˆæ— æ³•è¯†åˆ«æ­£åœ¨å†™å…¥çš„æ–‡ä»¶ï¼Œåœ¨ NFS ç¯å¢ƒä¸‹ææ˜“äº§ç”Ÿâ€œè„è¯»â€ï¼Œæ•°æ®ä¸€è‡´æ€§ç­‰çº§ä¸ºâ€œä½â€ã€‚</li>
                    <li><span class="task-name">OS Integrity (Double Sampling)</span>: æ¨¡æ‹Ÿ NFS ç¯å¢ƒä¸‹ç¡®ä¿æ–‡ä»¶å®Œæ•´çš„çœŸå®æ–¹æ¡ˆã€‚åŒ…å«é¦–æ¬¡é‡‡æ · -> å¼ºåˆ¶ <strong>{{integrity_interval}}s</strong> ç‰©ç†ç­‰å¾… -> äºŒæ¬¡æ ¡éªŒã€‚<strong>å½“å‰æµ‹é‡å€¼ä¸ºæ— é‡è¯•çš„æœ€ä¼˜æ€§èƒ½ã€‚</strong></li>
                    <li><span class="task-name">Fusion API (Perception Mode)</span>: åŸºäº Agent å®æ—¶æ„ŸçŸ¥çš„å…ƒæ•°æ®æ£€ç´¢ã€‚æ— éœ€ä»»ä½•ç‰©ç†é™é»˜ç­‰å¾…å³å¯è¿”å›å¯é æ•°æ®ã€‚</li>
                </ul>
            </section>
        </div>
    </div>

    <script>
        const rawData = /* RESULTS_JSON_DATA */;
        function format(num, decimals = 2) { return num ? num.toFixed(decimals) : '0.00'; }
        const tableBody = document.querySelector('#metrics-table tbody');
        const metrics = [
            { label: 'Avg Latency', key: 'avg' },
            { label: 'P50 (Median)', key: 'p50' },
            { label: 'P95 Latency', key: 'p95' },
            { label: 'P99 Latency', key: 'p99' },
            { label: 'QPS', key: 'qps', dec: 1 },
            { label: 'Min', key: 'min' },
            { label: 'Max', key: 'max' }
        ];
        const groups = ['os', 'os_integrity', 'fusion_dry_net', 'fusion_dry', 'fusion'];
        metrics.forEach(m => {
            const row = document.createElement('tr');
            row.innerHTML = `<td><strong>${m.label}</strong></td>` + 
                groups.map(g => `<td>${format(rawData[g][m.key], m.dec)}</td>`).join('');
            tableBody.appendChild(row);
        });

        const commonLabels = ['OS Baseline', 'OS Integrity*', 'Fusion API'];
        const getVal = (key) => [rawData.os[key], rawData.os_integrity[key], rawData.fusion[key]];

        // 1. QPS Chart
        new Chart(document.getElementById('qpsChart'), {
            type: 'bar',
            data: {
                labels: commonLabels,
                datasets: [{ 
                    label: 'QPS', 
                    data: getVal('qps'), 
                    backgroundColor: ['#3498db', '#e74c3c', '#2ecc71'],
                    maxBarThickness: 40
                }]
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { type: 'logarithmic', title: { display: true, text: 'Requests/sec (Log Scale)' } } }
            }
        });

        // 2. Latency Chart
        new Chart(document.getElementById('latencyChart'), {
            type: 'bar',
            data: {
                labels: commonLabels,
                datasets: [{ 
                    label: 'Avg Latency', 
                    data: getVal('avg'), 
                    backgroundColor: ['#3498db', '#e74c3c', '#2ecc71'],
                    maxBarThickness: 40
                }]
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { type: 'logarithmic', title: { display: true, text: 'ms (Log Scale)' } } }
            }
        });

        // 3. Line Chart
        const pLabels = ['Min', 'P50', 'P75', 'P90', 'P95', 'P99', 'Max'];
        const getS = (g) => [rawData[g].min, rawData[g].p50, rawData[g].p75, rawData[g].p90, rawData[g].p95, rawData[g].p99, rawData[g].max];
        new Chart(document.getElementById('lineChart'), {
            type: 'line',
            data: {
                labels: pLabels,
                datasets: [
                    { label: 'OS Baseline', data: getS('os'), borderColor: '#3498db', fill: false, tension: 0.1 },
                    { label: 'OS Integrity*', data: getS('os_integrity'), borderColor: '#e74c3c', fill: false, tension: 0.1 },
                    { label: 'Fusion API', data: getS('fusion'), borderColor: '#2ecc71', fill: false, tension: 0.1 }
                ]
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                scales: { y: { type: 'logarithmic' } },
                plugins: { legend: { position: 'bottom' } }
            }
        });
    </script>
</body>
</html>